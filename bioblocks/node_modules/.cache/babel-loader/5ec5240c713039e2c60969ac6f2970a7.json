{"remainingRequest":"C:\\Users\\noest\\Desktop\\fullstack\\bioblocks\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\noest\\Desktop\\fullstack\\bioblocks\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\noest\\Desktop\\fullstack\\bioblocks\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\noest\\Desktop\\fullstack\\bioblocks\\src\\components\\Bioblocks.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\noest\\Desktop\\fullstack\\bioblocks\\src\\components\\Bioblocks.vue","mtime":1557587742078},{"path":"C:\\Users\\noest\\Desktop\\fullstack\\bioblocks\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\noest\\Desktop\\fullstack\\bioblocks\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\noest\\Desktop\\fullstack\\bioblocks\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\noest\\Desktop\\fullstack\\bioblocks\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.array.find\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport paper from \"paper\";\nimport { APIService } from \"../APIService\";\nvar apiService = new APIService(); // Pin location in the Arduino image\n\nvar pins = [{\n  name: \"A0\",\n  x: 213,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A1\",\n  x: 222,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A2\",\n  x: 232,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A3\",\n  x: 241,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A4\",\n  x: 251,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A5\",\n  x: 260,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A6\",\n  x: 270,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A7\",\n  x: 279,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A8\",\n  x: 300,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A9\",\n  x: 309,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A10\",\n  x: 318,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A11\",\n  x: 328,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A12\",\n  x: 337,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A13\",\n  x: 346,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A14\",\n  x: 356,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"A15\",\n  x: 365,\n  y: 188,\n  type: \"analog\"\n}, {\n  name: \"D13\",\n  x: 132,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D12\",\n  x: 141,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D11\",\n  x: 151,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D10\",\n  x: 160,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D9\",\n  x: 169,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D8\",\n  x: 179,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D7\",\n  x: 194,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D6\",\n  x: 204,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D5\",\n  x: 214,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D4\",\n  x: 223,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D3\",\n  x: 233,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D2\",\n  x: 242,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D1\",\n  x: 252,\n  y: 7,\n  type: \"digital\"\n}, {\n  name: \"D0\",\n  x: 261,\n  y: 7,\n  type: \"digital\"\n}];\nvar hwPaperComponents = []; // List of paper.js rendered components (so we can rerender)\n\nfunction getPinPoint(name) {\n  var pin = pins.find(function (val) {\n    return val.name == name;\n  });\n\n  if (!pin) {\n    console.warn(\"Warning: Pin not found by name %s\", name);\n    return new Point(0, 0);\n  }\n\n  return new Point(pin.x, pin.y).add(raster.bounds.topLeft).add(new Size(3, 3));\n}\n/**\r\n * connectToPin links a rectangle and a pin by its name\r\n */\n\n\nfunction connectToPin(rect, pin) {\n  var pathToPin = new Path();\n  pathToPin.strokeColor = \"black\";\n  pathToPin.add(rect.bounds.bottomCenter);\n  pathToPin.add(getPinPoint(pin));\n  pathToPin.remove(); // Only add it after we add it to group\n\n  return pathToPin;\n}\n\nexport default {\n  name: \"todo-bio\",\n  props: [\"methodSave\", \"methodAdd\", \"dataxml\", \"methodEdit\", \"isOwner\"],\n  data: function data() {\n    return {\n      viewExperiment: true,\n      experimentLoading: true,\n      canvasReady: false,\n      // Whether or not the canvas has been rendered on-screen once\n      experimentWorkspaceBlocks: {},\n      // Set of blocks and connections currently on the experiment\n      dialog: false,\n      valid: true,\n      namesRules: {\n        id_user: [function (v) {\n          return !!v || \"Id is required\";\n        }]\n      },\n      ruleForm1: {\n        id_user: \"\"\n      }\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    paper.install(window); // Get a reference to the canvas object\n\n    var canvas = document.getElementById(\"myCanvas\"); // Create an empty project and a view for the canvas:\n\n    paper.setup(canvas); // [Blockly is served at port 9000]\n\n    var remoteOrigin = window.location.protocol + \"//\" + window.location.hostname + \":9000\"; // Prepare communication with iframe\n\n    var pthis = this;\n    window.addEventListener(\"message\", function (event) {\n      if (event.origin != remoteOrigin) {\n        console.warn(\"Discarding postMessage from origin %s\", event.origin);\n        return;\n      }\n\n      pthis.onWorkspaceEvent(event);\n    }, false); // Create the blockly iframe\n\n    var iframe = document.createElement(\"iframe\");\n    iframe.setAttribute(\"src\", remoteOrigin + \"/pxt-blockly/workspace.html?parent=\" + window.location);\n    iframe.setAttribute(\"id\", \"frame\");\n    iframe.style.width = \"100%\";\n    iframe.style.height = \"100%\";\n    iframe.setAttribute(\"sandbox\", \"allow-scripts allow-same-origin\");\n\n    iframe.onload = function () {\n      _this.experimentLoading = false;\n    };\n\n    document.getElementById(\"bioblocks-editor\").appendChild(iframe);\n  },\n  methods: {\n    prepareCanvas: function prepareCanvas() {\n      var paper = window.paper;\n      var view = window.view; // Gets set up by paper\n\n      var myImage = new Image(1014, 500);\n      myImage.src = \"/img/arduino_mega_clean.png\"; // Create a raster item using the image & put it on the center\n\n      var raster = new paper.Raster({\n        image: myImage,\n        smoothing: true\n      });\n      raster.position = view.center;\n      raster.scale(0.4); // Pin location\n\n      window.raster = raster;\n\n      for (var _i = 0; _i < pins.length; _i++) {\n        var pin = pins[_i];\n        var topLeft = new paper.Point(pin.x, pin.y);\n        var rectSize = new paper.Size(4, 4);\n        var rect = new paper.Rectangle(topLeft.add(raster.bounds.topLeft), rectSize);\n        var shape = new paper.Shape.Rectangle(rect);\n        shape.strokeColor = \"white\";\n\n        if (pin.type == \"analog\") {\n          shape.fillColor = \"green\";\n        } else if (pin.type == \"digital\") {\n          shape.fillColor = \"red\";\n        }\n\n        raster.addChild(rect);\n      } // Mark as ready\n\n\n      this.canvasReady = true;\n      paper.view.draw();\n    },\n    makeRectangle: function makeRectangle(topLeft, size, cornerSize, colour) {\n      var rectangle = new Rectangle(topLeft, size);\n      var cornerSize = cornerSize;\n      var path = new Path.RoundRectangle(rectangle, cornerSize);\n      path.fillColor = colour;\n      return path;\n    },\n    onWorkspaceEvent: function onWorkspaceEvent(event) {\n      if (event.data && event.data.type == \"workspace_hw_status\") {\n        this.experimentWorkspaceBlocks = event.data.hw;\n      } else if (event.data.type == \"save\") {\n        var info = {\n          id_project: \"\",\n          xml_file: event.data.xml\n        };\n        this.methodSave(info);\n      } else if (event.data.type === \"load\") {\n        var frame = document.getElementById(\"frame\");\n        frame.contentWindow.postMessage({\n          type: \"load\",\n          xml: this.dataxml\n        }, \"*\");\n      }\n    },\n    save: function save() {\n      var frame = document.getElementById(\"frame\");\n      frame.contentWindow.postMessage({\n        type: \"save\"\n      }, \"*\");\n    },\n    clone: function clone() {\n      this.$router.push({\n        name: \"newproject\",\n        params: {\n          xml_file: this.dataxml\n        }\n      });\n    },\n    voidF: function voidF() {},\n    addUser: function addUser(formName) {\n      var _this2 = this;\n\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          var info = {\n            id_user: _this2.ruleForm1.id_user,\n            id_project: \"\"\n          };\n\n          _this2.methodAdd(info);\n        }\n      });\n    },\n    renderComponents: function renderComponents() {\n      // Clean up the components first\n      for (var component in hwPaperComponents) {\n        hwPaperComponents[component].removeChildren();\n        hwPaperComponents[component].remove();\n      }\n\n      hwPaperComponents = [];\n      var rectCount = 0;\n\n      for (var key in this.experimentWorkspaceBlocks) {\n        var blockInfo = this.experimentWorkspaceBlocks[key];\n        var componentName = void 0;\n\n        switch (blockInfo.type) {\n          case \"new_centrifuge\":\n            componentName = \"CENTRIFUGE\";\n            break;\n\n          default:\n            // TODO: Have the block supply its own name, instead of this hardcoded list\n            componentName = \"????\";\n            break;\n        }\n\n        rectCount++; // Create the hw rectangle\n\n        var xy1 = view.center.subtract(new Size(0, 150 + 100 * rectCount)); //Position of the rectangle.\n\n        var size = new Size(100, 80); //Size\n\n        var c = new Size(8, 8); //Corner radius\n\n        var col = \"#167ee5\"; //Colour\n\n        var g = new Group();\n        var rect = this.makeRectangle(xy1, size, c, col);\n        var text = new PointText(rect.bounds.topLeft.add(new Point(10, 45)));\n        text.content = componentName;\n        text.style = {\n          fillColor: \"white\"\n        };\n        g.addChild(rect);\n        g.addChild(text);\n\n        for (var n in blockInfo.connections.analog) {\n          var pin = blockInfo.connections.analog[n];\n\n          if (pin) {\n            g.addChild(connectToPin(rect, pin));\n          }\n        }\n\n        for (var _n in blockInfo.connections.digital) {\n          var _pin = blockInfo.connections.digital[_n];\n\n          if (_pin) {\n            g.addChild(connectToPin(rect, _pin));\n          }\n        }\n\n        hwPaperComponents.push(g); // Add the group of elements to the list\n      }\n    }\n  },\n  watch: {\n    viewExperiment: function viewExperiment(newVal, oldVal) {\n      var _this3 = this;\n\n      if (!newVal) {\n        // Redraw the canvas with the correct width to remove artifacting\n        // The timeout works around some... browser processing? Without it,\n        // both properties return 0 (as does the bounding box)\n        setTimeout(function () {\n          if (!_this3.canvasReady) {\n            // Dynamically create a canvas. A canvas created out of render view\n            // doesn't properly work\n            var canvasParent = document.getElementById(\"bioblocks-hardware\");\n            var canvasEle = document.createElement(\"canvas\");\n            canvasEle.id = \"myCanvas\";\n            canvasEle.setAttribute(\"resize\", true);\n            canvasParent.appendChild(canvasEle);\n            paper.setup(canvasEle);\n\n            _this3.prepareCanvas();\n\n            var width = canvasParent.offsetWidth;\n            var height = canvasParent.offsetHeight;\n            paper.view.viewSize = new paper.Size(width, height);\n          }\n\n          _this3.renderComponents();\n        }, 100);\n      }\n    }\n  }\n};",{"version":3,"sources":["Bioblocks.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"bioblocks\">\r\n    <div style=\"font-size: 22px;\">\r\n      <ui class=\"list-elements\">\r\n        <li style=\"margin-right: 3em;\">\r\n          <v-menu :nudge-width=\"100\" offset-y>\r\n            <template v-slot:activator=\"{ on }\">\r\n              <v-toolbar-title v-on=\"on\" style=\"cursor: pointer; font-size: 0.875em;\">File</v-toolbar-title>\r\n            </template>\r\n            <v-list v-if=\"this.isOwner\">\r\n              <v-list-tile @click=\"save()\">\r\n                <v-list-tile-title>\r\n                  <v-icon small>cloud_upload</v-icon> Save\r\n                </v-list-tile-title>\r\n              </v-list-tile>\r\n              <v-divider></v-divider>\r\n              <v-list-tile @click=\"methodEdit()\">\r\n                <v-list-tile-title>\r\n                  <v-icon small>build</v-icon> Settings\r\n                </v-list-tile-title>\r\n              </v-list-tile>\r\n            </v-list>\r\n            <v-list v-if=\"!this.isOwner\">\r\n              <v-list-tile @click=\"clone()\">\r\n                <v-list-tile-title>\r\n                  <v-icon small>cloud_upload</v-icon> Clone\r\n                </v-list-tile-title>\r\n              </v-list-tile>\r\n            </v-list>\r\n          </v-menu>\r\n        </li>\r\n        <li style=\"margin-right: 3em;\" v-if=\"this.isOwner\">\r\n          <v-menu :nudge-width=\"100\" offset-y>\r\n            <template v-slot:activator=\"{ on }\">\r\n              <v-toolbar-title v-on=\"on\" style=\"cursor: pointer; font-size: 0.875em;\">Share</v-toolbar-title>\r\n            </template>\r\n            <v-list>\r\n              <v-list-tile @click=\"voidF()\">\r\n                <v-list-tile-title>\r\n                  <v-dialog v-model=\"dialog\" width=\"300\">\r\n                    <template v-slot:activator=\"{ on }\">\r\n                      <div v-on=\"on\">\r\n                        <v-icon small>folder_shared</v-icon> Add user\r\n                      </div>\r\n                    </template>\r\n                    <v-card style=\"height:220px;\">\r\n                      <el-form\r\n                        class=\"newform\"\r\n                        :model=\"ruleForm1\"\r\n                        :rules=\"namesRules\"\r\n                        ref=\"ruleForm1\"\r\n                        v-model=\"valid\"\r\n                        lazy-validation\r\n                        style=\"height: 200px;\"\r\n                      >\r\n                        <v-text-field\r\n                          color=\"green\"\r\n                          v-model=\"ruleForm1.id_user\"\r\n                          :counter=\"15\"\r\n                          label=\"Username\"\r\n                          required\r\n                          style=\"margin-top:50%;\"\r\n                        ></v-text-field>\r\n                        <el-button class=\"successB\"\r\n                          @click=\"addUser('ruleForm1')\"\r\n                          color=\"green\"\r\n                          :disabled=\"!valid\"\r\n                          style=\"margin-top:10%;\"\r\n                        >Add user</el-button>\r\n                      </el-form>\r\n                    </v-card>\r\n                  </v-dialog>\r\n                </v-list-tile-title>\r\n              </v-list-tile>\r\n            </v-list>\r\n          </v-menu>\r\n        </li>\r\n      </ui>\r\n    </div>\r\n    <v-divider></v-divider>\r\n    <el-switch\r\n      v-model=\"viewExperiment\"\r\n      active-color=\"#13ce66\"\r\n      inactive-color=\"#dcdfe6\"\r\n      active-text=\"Experimento\"\r\n      inactive-text=\"Hardware\"\r\n      style=\"padding-top: 0.4em; padding-bottom: 0.4em;\"\r\n    ></el-switch>\r\n    <!-- v-show over v-if here is important (v-if just reloads the iframe all the time) -->\r\n    <div\r\n      id=\"bioblocks-editor\"\r\n      v-show=\"viewExperiment\"\r\n      v-loading=\"experimentLoading\"\r\n      style=\"width: 95%; margin: 0 auto;\"\r\n    ></div>\r\n    <div id=\"bioblocks-hardware\" v-show=\"!viewExperiment\" style=\"width: 95%; margin: 0 auto;\"></div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport paper from \"paper\";\r\nimport { APIService } from \"../APIService\";\r\nconst apiService = new APIService();\r\n\r\n// Pin location in the Arduino image\r\nlet pins = [\r\n  { name: \"A0\", x: 213, y: 188, type: \"analog\" },\r\n  { name: \"A1\", x: 222, y: 188, type: \"analog\" },\r\n  { name: \"A2\", x: 232, y: 188, type: \"analog\" },\r\n  { name: \"A3\", x: 241, y: 188, type: \"analog\" },\r\n  { name: \"A4\", x: 251, y: 188, type: \"analog\" },\r\n  { name: \"A5\", x: 260, y: 188, type: \"analog\" },\r\n  { name: \"A6\", x: 270, y: 188, type: \"analog\" },\r\n  { name: \"A7\", x: 279, y: 188, type: \"analog\" },\r\n  { name: \"A8\", x: 300, y: 188, type: \"analog\" },\r\n  { name: \"A9\", x: 309, y: 188, type: \"analog\" },\r\n  { name: \"A10\", x: 318, y: 188, type: \"analog\" },\r\n  { name: \"A11\", x: 328, y: 188, type: \"analog\" },\r\n  { name: \"A12\", x: 337, y: 188, type: \"analog\" },\r\n  { name: \"A13\", x: 346, y: 188, type: \"analog\" },\r\n  { name: \"A14\", x: 356, y: 188, type: \"analog\" },\r\n  { name: \"A15\", x: 365, y: 188, type: \"analog\" },\r\n\r\n  { name: \"D13\", x: 132, y: 7, type: \"digital\" },\r\n  { name: \"D12\", x: 141, y: 7, type: \"digital\" },\r\n  { name: \"D11\", x: 151, y: 7, type: \"digital\" },\r\n  { name: \"D10\", x: 160, y: 7, type: \"digital\" },\r\n  { name: \"D9\", x: 169, y: 7, type: \"digital\" },\r\n  { name: \"D8\", x: 179, y: 7, type: \"digital\" },\r\n  { name: \"D7\", x: 194, y: 7, type: \"digital\" },\r\n  { name: \"D6\", x: 204, y: 7, type: \"digital\" },\r\n  { name: \"D5\", x: 214, y: 7, type: \"digital\" },\r\n  { name: \"D4\", x: 223, y: 7, type: \"digital\" },\r\n  { name: \"D3\", x: 233, y: 7, type: \"digital\" },\r\n  { name: \"D2\", x: 242, y: 7, type: \"digital\" },\r\n  { name: \"D1\", x: 252, y: 7, type: \"digital\" },\r\n  { name: \"D0\", x: 261, y: 7, type: \"digital\" }\r\n];\r\n\r\nlet hwPaperComponents = []; // List of paper.js rendered components (so we can rerender)\r\nfunction getPinPoint(name) {\r\n  let pin = pins.find(val => {\r\n    return val.name == name;\r\n  });\r\n\r\n  if (!pin) {\r\n    console.warn(\"Warning: Pin not found by name %s\", name);\r\n    return new Point(0, 0);\r\n  }\r\n\r\n  return new Point(pin.x, pin.y).add(raster.bounds.topLeft).add(new Size(3, 3));\r\n}\r\n\r\n/**\r\n * connectToPin links a rectangle and a pin by its name\r\n */\r\nfunction connectToPin(rect, pin) {\r\n  var pathToPin = new Path();\r\n  pathToPin.strokeColor = \"black\";\r\n  pathToPin.add(rect.bounds.bottomCenter);\r\n  pathToPin.add(getPinPoint(pin));\r\n  pathToPin.remove(); // Only add it after we add it to group\r\n\r\n  return pathToPin;\r\n}\r\n\r\nexport default {\r\n  name: \"todo-bio\",\r\n  props: [\"methodSave\", \"methodAdd\", \"dataxml\", \"methodEdit\", \"isOwner\"],\r\n  data() {\r\n    return {\r\n      viewExperiment: true,\r\n      experimentLoading: true,\r\n      canvasReady: false, // Whether or not the canvas has been rendered on-screen once\r\n      experimentWorkspaceBlocks: {}, // Set of blocks and connections currently on the experiment\r\n      dialog: false,\r\n      valid: true,\r\n      namesRules: {\r\n        id_user: [v => !!v || \"Id is required\"]\r\n      },\r\n      ruleForm1: {\r\n        id_user: \"\"\r\n      }\r\n    };\r\n  },\r\n  mounted() {\r\n    paper.install(window);\r\n\r\n    // Get a reference to the canvas object\r\n    let canvas = document.getElementById(\"myCanvas\");\r\n    // Create an empty project and a view for the canvas:\r\n    paper.setup(canvas);\r\n\r\n    // [Blockly is served at port 9000]\r\n    const remoteOrigin =\r\n      window.location.protocol + \"//\" + window.location.hostname + \":9000\";\r\n\r\n    // Prepare communication with iframe\r\n    let pthis = this;\r\n    window.addEventListener(\r\n      \"message\",\r\n      function(event) {\r\n        if (event.origin != remoteOrigin) {\r\n          console.warn(\"Discarding postMessage from origin %s\", event.origin);\r\n          return;\r\n        }\r\n        pthis.onWorkspaceEvent(event);\r\n      },\r\n      false\r\n    );\r\n\r\n    // Create the blockly iframe\r\n    var iframe = document.createElement(\"iframe\");\r\n    iframe.setAttribute(\r\n      \"src\",\r\n      remoteOrigin + \"/pxt-blockly/workspace.html?parent=\" + window.location\r\n    );\r\n    iframe.setAttribute(\"id\", \"frame\");\r\n    iframe.style.width = \"100%\";\r\n    iframe.style.height = \"100%\";\r\n    iframe.setAttribute(\"sandbox\", \"allow-scripts allow-same-origin\");\r\n    iframe.onload = () => {\r\n      this.experimentLoading = false;\r\n    };\r\n\r\n    document.getElementById(\"bioblocks-editor\").appendChild(iframe);\r\n  },\r\n  methods: {\r\n    prepareCanvas() {\r\n      const paper = window.paper;\r\n      const view = window.view; // Gets set up by paper\r\n\r\n      var myImage = new Image(1014, 500);\r\n      myImage.src = \"/img/arduino_mega_clean.png\";\r\n\r\n      // Create a raster item using the image & put it on the center\r\n      let raster = new paper.Raster({\r\n        image: myImage,\r\n        smoothing: true\r\n      });\r\n      raster.position = view.center;\r\n      raster.scale(0.4);\r\n\r\n      // Pin location\r\n      window.raster = raster;\r\n\r\n      for (let pin of pins) {\r\n        var topLeft = new paper.Point(pin.x, pin.y);\r\n        var rectSize = new paper.Size(4, 4);\r\n        var rect = new paper.Rectangle(\r\n          topLeft.add(raster.bounds.topLeft),\r\n          rectSize\r\n        );\r\n        var shape = new paper.Shape.Rectangle(rect);\r\n        shape.strokeColor = \"white\";\r\n        if (pin.type == \"analog\") {\r\n          shape.fillColor = \"green\";\r\n        } else if (pin.type == \"digital\") {\r\n          shape.fillColor = \"red\";\r\n        }\r\n\r\n        raster.addChild(rect);\r\n      }\r\n\r\n      // Mark as ready\r\n      this.canvasReady = true;\r\n      paper.view.draw();\r\n    },\r\n\r\n    makeRectangle(topLeft, size, cornerSize, colour) {\r\n      var rectangle = new Rectangle(topLeft, size);\r\n      var cornerSize = cornerSize;\r\n      var path = new Path.RoundRectangle(rectangle, cornerSize);\r\n      path.fillColor = colour;\r\n      return path;\r\n    },\r\n\r\n    onWorkspaceEvent(event) {\r\n      if (event.data && event.data.type == \"workspace_hw_status\") {\r\n        this.experimentWorkspaceBlocks = event.data.hw;\r\n      } else if (event.data.type == \"save\") {\r\n        var info = {\r\n          id_project: \"\",\r\n          xml_file: event.data.xml\r\n        };\r\n        this.methodSave(info);\r\n      } else if (event.data.type === \"load\") {\r\n        var frame = document.getElementById(\"frame\");\r\n        frame.contentWindow.postMessage(\r\n          {\r\n            type: \"load\",\r\n            xml: this.dataxml\r\n          },\r\n          \"*\"\r\n        );\r\n      }\r\n    },\r\n\r\n    save() {\r\n      var frame = document.getElementById(\"frame\");\r\n      frame.contentWindow.postMessage(\r\n        {\r\n          type: \"save\"\r\n        },\r\n        \"*\"\r\n      );\r\n    },\r\n\r\n    clone() {\r\n      this.$router.push({\r\n        name: \"newproject\",\r\n        params: { xml_file: this.dataxml }\r\n      });\r\n    },\r\n\r\n    voidF() {},\r\n\r\n    addUser(formName) {\r\n      this.$refs[formName].validate(valid => {\r\n        if (valid) {\r\n          var info = {\r\n            id_user: this.ruleForm1.id_user,\r\n            id_project: \"\"\r\n          };\r\n          this.methodAdd(info);\r\n        }\r\n      });\r\n    },\r\n\r\n    renderComponents() {\r\n      // Clean up the components first\r\n      for (let component in hwPaperComponents) {\r\n        hwPaperComponents[component].removeChildren();\r\n        hwPaperComponents[component].remove();\r\n      }\r\n\r\n      hwPaperComponents = [];\r\n      let rectCount = 0;\r\n      for (let key in this.experimentWorkspaceBlocks) {        \r\n        let blockInfo = this.experimentWorkspaceBlocks[key];\r\n        let componentName;\r\n\r\n        switch (blockInfo.type) {\r\n          case \"new_centrifuge\":\r\n            componentName = \"CENTRIFUGE\";\r\n            break;\r\n          default:\r\n            // TODO: Have the block supply its own name, instead of this hardcoded list\r\n            componentName = \"????\";\r\n            break;\r\n        }\r\n\r\n        rectCount++;\r\n\r\n        // Create the hw rectangle\r\n        var xy1 = view.center.subtract(new Size(0, 150 + 100 * rectCount)); //Position of the rectangle.\r\n        var size = new Size(100, 80); //Size\r\n        var c = new Size(8, 8); //Corner radius\r\n        var col = \"#167ee5\"; //Colour\r\n\r\n        let g = new Group();\r\n        let rect = this.makeRectangle(xy1, size, c, col);\r\n        var text = new PointText(rect.bounds.topLeft.add(new Point(10, 45)));\r\n        text.content = componentName;\r\n        text.style = {\r\n          fillColor: \"white\"\r\n        };\r\n        g.addChild(rect);\r\n        g.addChild(text);\r\n\r\n        for (let n in blockInfo.connections.analog) {\r\n          let pin = blockInfo.connections.analog[n];\r\n\r\n          if (pin) {\r\n            g.addChild(connectToPin(rect, pin));\r\n          }\r\n        }\r\n\r\n        for (let n in blockInfo.connections.digital) {\r\n          let pin = blockInfo.connections.digital[n];\r\n\r\n          if (pin) {\r\n            g.addChild(connectToPin(rect, pin));\r\n          }\r\n        }\r\n\r\n        hwPaperComponents.push(g); // Add the group of elements to the list\r\n      }\r\n    }\r\n  },\r\n  watch: {\r\n    viewExperiment(newVal, oldVal) {\r\n      if (!newVal) {\r\n        // Redraw the canvas with the correct width to remove artifacting\r\n        // The timeout works around some... browser processing? Without it,\r\n        // both properties return 0 (as does the bounding box)\r\n\r\n        setTimeout(() => {\r\n          if (!this.canvasReady) {\r\n            // Dynamically create a canvas. A canvas created out of render view\r\n            // doesn't properly work\r\n            let canvasParent = document.getElementById(\"bioblocks-hardware\");\r\n            let canvasEle = document.createElement(\"canvas\");\r\n            canvasEle.id = \"myCanvas\";\r\n            canvasEle.setAttribute(\"resize\", true);\r\n\r\n            canvasParent.appendChild(canvasEle);\r\n            paper.setup(canvasEle);\r\n            this.prepareCanvas();\r\n\r\n            const width = canvasParent.offsetWidth;\r\n            const height = canvasParent.offsetHeight;\r\n            paper.view.viewSize = new paper.Size(width, height);\r\n          }\r\n\r\n          this.renderComponents();\r\n        }, 100);\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n.bioblocks {\r\n  height: 80%;\r\n  width: 100%;\r\n}\r\n\r\n#bioblocks-editor,\r\n#bioblocks-hardware {\r\n  height: 100%;\r\n  width: 100%;\r\n}\r\n\r\n#bioblocks-editor iframe {\r\n  border: none;\r\n}\r\n\r\n.el-switch {\r\n  display: block;\r\n  height: 25px;\r\n  width: 30%;\r\n  margin: 0 auto;\r\n}\r\n\r\n.el-switch__label {\r\n  color: black;\r\n}\r\n\r\n.el-switch__label > span {\r\n  font-size: 1.4em !important;\r\n}\r\n\r\n.el-switch__label.is-active {\r\n  color: #4caf50;\r\n}\r\n\r\ncanvas {\r\n  height: 90%;\r\n  width: 100%;\r\n}\r\n\r\n.list-elements {\r\n  display: flex;\r\n  list-style: none;\r\n  margin-left: 3%;\r\n  padding-top: 0.4em;\r\n  padding-bottom: 0.4em;\r\n  font-size: 0.875em;\r\n  background-color: white;\r\n  color: black;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/components"}]}